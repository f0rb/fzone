"use strict";adminApp.run(["$rootScope",function(e){e.$on("$stateChangeSuccess",function(){angular.forEach(document.querySelectorAll(".modal-backdrop"),function(e){e.parentNode.removeChild(e)})})}]),adminApp.config(["$stateProvider","$urlRouterProvider",function(e,r){var n=angular.extend({base:"app",models:[]},window.Config);angular.forEach(n.models,function(r){var o=r.url,u=r.uri=r.url.split("?")[0],t={name:n.base+"."+u,url:o,views:{}};t.views[u]={templateUrl:"res/html/"+u+".html"},r.sticky&&(t.sticky=!0,t.deepStateRedirect=!0),e.state(t)}),e.state(n.base,{url:"/","abstract":!0,template:function(){var e="";return angular.forEach(n.models,function(r){e+='<div ui-view="'+r.uri+'" ng-show="$state.includes(\''+n.base+"."+r.uri+"')\"></div>"}),e}}),r.otherwise("/")}]).config(["$resourceProvider",function(e){e.defaults.actions.query.isArray=!1}]).provider("$menuStates",["$stateProvider",function(e){this.$get=function(){return{add:function(r,n){!n&&r&&r.name&&(n=r,r=r.name);try{e.state(r,n)}catch(o){console.log(o)}}}}}]),adminApp.run(["$rootScope","$http",function(e,r){e.loadMenu=function(){r.get("api/menu/tree").success(function(r){e.menuTree=r.result})},e.loadLoginUser=function(){r.get("login-user").success(function(r){r.success?(e.loginUser=r.result,e.loadMenu()):location.href="login?redirect="+encodeURIComponent(location.href)})}}]).run(["$rootScope","$state",function(e,r){e.$state=r}]),adminApp.factory("Dict",["$resource",function(e){return e("api/dict/:id",{id:"@id"})}]).controller("DictCtrl",["$scope","Dict",function(e,r){e.crud=new Crud(r,function(r){r.success?(e.crud.p.load(),$(".modal").modal("hide")):Util.handleFailure(r)})}]),adminApp.factory("Menu",["$resource",function(e){return e("api/menu/:id",{id:"@id"},{query:{isArray:!1},parent:{url:"api/menu/parent",method:"GET"}})}]).controller("MenuCtrl",["$scope","Menu",function(e,r){var n="访问错误";r.parent({},function(r){r.success?e.parents=r.result:alert(r.message||n)}),r.query({},function(r){r.success?e.menus=r.result:alert(r.message||n)}),e.crud=new Crud(r,function(r){r.success?(e.crud.p.load(),e.loadMenu(),$(".modal").modal("hide")):Util.handleFailure(r)})}]),adminApp.factory("Perm",["$resource",function(e){return e("api/perm/:id",{id:"@id"})}]).controller("PermCtrl",["$scope","Perm",function(e,r){e.crud=new Crud(r,function(r){r.success?(e.crud.p.load(),$(".modal").modal("hide")):Crud.handleFailure(r)})}]),adminApp.factory("Role",["$resource",function(e){return e("api/role/:id",{id:"@id"},{updateMenu:{url:"api/role/:id/menu",method:"POST"}})}]).controller("RoleCtrl",["$scope","Role",function(e,r){e.crud=new Crud(r,function(r){r.success?(e.crud.p.load(),$(".modal").modal("hide")):Util.handleFailure(r)}),e.crud.getMenu=function(n){e.crud.record=n,e.roleMenus={},r.get({id:n.id},function(r){if(r.success){e.crud.record=r.result;var n=r.result.menus;if(n)for(var o=0;o<n.length;o++)e.roleMenus[n[o]]=!0}})},e.crud.configMenu=function(n){var o=e.roleMenus,u=[];for(var t in o)o[t]&&u.push(Number(t));r.updateMenu({id:n.id},u,function(e){e.success?$(".modal").modal("hide"):alert(e.message||"访问失败")},function(e){Util.handleFailure(e)})}}]),adminApp.factory("User",["$resource",function(e){return e("api/user/:id",{id:"@id"},{query:{isArray:!1},updateRole:{url:"api/user/:id/role",method:"POST"},roles:{url:"api/role/list"}})}]).controller("UserCtrl",["$scope","User",function(e,r){function n(e){var r={},n="createTime|createUserId|updateTime|updateUserId|deleted";for(var o in e)e.hasOwnProperty(o)&&n.indexOf(o)<0&&(r[o]=e[o]);return r}function o(r){r.success?(e.p.load(),$(".modal").modal("hide")):Util.handleFailure(r)}function u(e){"object"==typeof e?alert("Status["+e.status+"]: "+(e.data.message||e.statusText||t)):alert("string"==typeof e?e:t)}var t="访问错误";e.add=function(){e.user={},e.userRoles={}},e.edit=function(r){e.user=n(r)},e.view=function(r){e.user=r},e.save=function(n){n.roles=[];for(var t in e.userRoles)e.userRoles[t]&&n.roles.push(Number(t));r.save(n,o,u)},r.roles(function(r){e.roles=r.result}),e.updateRole=function(n){var t={id:n.id};t.roles=[];for(var i in e.userRoles)e.userRoles[i]&&t.roles.push(Number(i));r.updateRole(t,o,u)},e.role=function(n){e.user=n,e.userRoles={},r.get({id:n.id},function(r){if(r.success&&(e.user=r.result,e.user.roles))for(var n=0;n<e.user.roles.length;n++)e.userRoles[e.user.roles[n].id]=!0})},e.remove=function(e){confirm("确定要删除用户["+e.username+"]吗?")&&r.remove({},{id:e.id},o,u)},e.p=new Page(r.query).load()}]);