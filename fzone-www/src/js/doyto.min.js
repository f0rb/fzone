"use strict";var doyto=angular.module("doyto.fzone",[]),Crud=function(t,i,o){function e(t){var i={},o="createTime|createUserId|updateTime|updateUserId|deleted";for(var e in t)t.hasOwnProperty(e)&&o.indexOf(e)<0&&(i[e]=t[e]);return i}var n="访问错误",a=!1,r=function(t){a=!1,"function"==typeof i?i(t):t.success||alert(t.message||n)},c=function(t){a=!1,"function"==typeof o?o(t):"object"==typeof t?alert("Status["+t.status+"]: "+(t.data.message||t.statusText||n)):alert("string"==typeof t?t:n)};this.add=function(){this.record={}},this.edit=function(t){this.record=e(t)},this.view=function(t){this.record=t},this.save=function(i){a||(a=!0,t.save(i,r,c))},this.remove=function(i,o){confirm(o||"确定要删除这条记录吗?")&&t.remove({},{id:i.id},r,c)},this.p=new Page(t.query).load()};doyto.directive("dyHref",function(){return{link:function(t,i,o){var e=i[0];"A"===e.tagName&&(e.style.cursor="pointer",e.onclick=function(){location.href=o.dyHref})}}}),doyto.filter("regex",function(){return function(t,i,o){if(!t||!t.length)return[];var e=[];o=new RegExp(o);for(var n=0;n<t.length;n++)o.test(t[n][i])&&e.push(t[n]);return e}}).filter("capitalize",function(){return function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}});var Page=function(t){function i(t){if(t.success){if("number"==typeof t.total){r=t.total;var i=Math.ceil(r/n);if(a!==i&&(a=i,e>i))return e=Math.min(i,1),void(this&&this.load());!e&&a&&(e=1);var o=this;o.page=e,o.limit=n,o.pages=a,o.total=r,o.from=Math.max((e-1)*n+1,0),o.to=Math.min(e*n,r),o.result=t.result}}else Util.handleFailure(t)}var o,e=0,n=10,a=0,r=0;this.q={},this.isQueryChanged=function(){return!angular.equals(this.q,o)},this.load=function(a){var r=this.q;if(!a||!angular.equals(this.q,o))return r.page=e||1,r.limit=n,o=angular.copy(r),t(r,angular.bind(this,i)),this},this.first=function(){e>1&&(e=1,this.load())},this.last=function(){e!==a&&(e=a,this.load())},this.prev=function(){e>1&&(e--,this.load())},this.next=function(){a>e&&(e++,this.load())},this.size=function(t){n=t,e=Math.min(e,Math.ceil(r/n)),e=Math.max(e,1),this.load()},this["goto"]=function(t){e=t,this.load()},this.reset=function(){this.q={},e=1,this.load()}},Util=window.Util||{};Util.formHttpRequestTransform=function(t){var i=function(t){var o,e,n,a,r,c,s,h="";for(o in t)if(t.hasOwnProperty(o)&&!o.startsWith("$$"))if(e=t[o],e instanceof Array)for(s=0;s<e.length;++s)r=e[s],n=o+"["+s+"]",c={},c[n]=r,h+=i(c)+"&";else if(e instanceof Object)for(a in e)e.hasOwnProperty(a)&&(r=e[a],n=o+"["+a+"]",c={},c[n]=r,h+=i(c)+"&");else void 0!==e&&null!==e&&(h+=encodeURIComponent(o)+"="+encodeURIComponent(e)+"&");return h.length?h.substr(0,h.length-1):h};return angular.isObject(t)&&"[object File]"!==String(t)?i(t):t},Util.escapeHTML=function(t){return t?t.replace(/[\"'\/<>]/g,function(t){return{'"':"&quot;","'":"&#39;","/":"&#47;","<":"&lt;",">":"&gt;"}[t]}):""},Util.capitalize=function(t){return"string"==typeof t?t.charAt(0).toUpperCase()+t.slice(1):t},Util.handleFailure=function(t){t&&!t.success&&("0001"===t.code?location.href="login?redirect="+encodeURIComponent(location.href):alert(t.message||"访问错误"))},function(t){t.email2site=function(i){t.open({"gmail.com":"http://gmail.com","hotmail.com":"http://www.hotmail.com","live.com":"http://www.hotmail.com","126.com":"http://mail.126.com","163.com":"http://mail.163.com","sina.com":"http://mail.sina.com.cn","sina.cn":"http://mail.sina.com.cn","qq.com":"http://mail.qq.com","vip.qq.com":"http://mail.qq.com","foxmail.com":"http://mail.qq.com","yahoo.com":"http://mail.yahoo.com","yahoo.com.tw":"http://mail.yahoo.com.tw","yahoo.com.hk":"http://mail.yahoo.com.hk","sohu.com":"http://mail.sohu.com","yeah.net":"http://www.yeah.net","yahoo.cn":"http://mail.yahoo.cn"}[i.substring(i.indexOf("@")+1)]||"http://"+i)}}(window);